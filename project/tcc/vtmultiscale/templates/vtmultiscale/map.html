{% load staticfiles %}
{% load static from staticfiles %}
<!DOCTYPE html>
<meta charset="utf-8">
<style>

.state {
  fill: #ddc;
  fill-opacity: 0.1;
}

.state_contour {
  fill: none;
  stroke: black;
  stroke-linejoin: round;
}

</style>
<body>
  <script src="{% static 'vtmultiscale/d3/d3.min.js' %}" type="text/javascript"></script>
  <script src="{% static 'vtmultiscale/jquery/jquery-3.1.1.min.js' %}" type="text/javascript"></script>
<script src="{% static 'vtmultiscale/d3-queue/d3-queue.min.js' %}" type="text/javascript"></script>
<script src="{% static 'vtmultiscale/topojson/topojson.min.js' %}" type="text/javascript"></script>
<script>

// Define map size on screen
var width = 960,
    height = 600;

var svg = d3.select("body").append("svg")
    .attr("width", width)
    .attr("height", height);

var g = svg.append("g");

var zoom = d3.behavior.zoom()
  .translate([0, 0])
  .scale(1)
  .scaleExtent([1, 8])
  .on("zoom", zoomed);

svg.call(zoom) // delete this line to disable free zooming
  .call(zoom.event);

// Align center of Brazil to center of map
var projection = d3.geo.mercator()
  .scale(650)
  .center([-52, -15])
  .translate([width / 2, height / 2]);

var path = d3.geo.path()
  .projection(projection);

// Load data (asynchronously)
d3_queue.queue()
    .defer(d3.json, "{% static 'vtmultiscale/br-states.json' %}")
//    .defer(d3.json, "{% static 'vtmultiscale/br-states-full.json' %}")
    .await(ready);

    //.defer(d3.json, "https://raw.githubusercontent.com/thiagomarzagao/thiagomarzagao.github.io/master/assets/br-states.json")
    //.defer(d3.json, "{% static 'vtmultiscale/br-states.json' %}")
function ready(error, shp) {
  if (error) throw error;

  // Extracting polygons and contours
  /*
  var states = topojson.feature(shp, shp.objects.states);
  var states_contour = topojson.mesh(shp, shp.objects.states);
  */
  var states = topojson.feature(shp, shp.objects.estados);
  var states_contour = topojson.mesh(shp, shp.objects.estados);

  // Desenhando estados
  g.selectAll(".estado")
      .data(states.features)
    .enter()
      .append("path")
      .attr("class", "state")
      .attr("d", path);

  g.append("path")
    .datum(states_contour)
    .attr("d", path)
    .attr("class", "state_contour");


}
station_geo_array = []
    {% for station in stations %}
        console.log({{station.lat}});
        station_geo_array.push(
                [{{station.long}}, {{station.lat}}]
            )
    {% endfor %}
    aa = [-48.02, -25.13];
    bb = [-49.41, -19.58];

    console.log(projection(aa),projection(bb));
    g.selectAll("circle")
		.data(station_geo_array).enter()
		.append("circle")
		.attr("cx", function (d) { return projection(d)[0]; })
		.attr("cy", function (d) { return projection(d)[1]; })
		.attr("r", "1px")
		.attr("fill", "red")
// What to do when zooming
function zoomed() {
  g.style("stroke-width", 1.5 / d3.event.scale + "px");
  g.attr("transform", "translate(" + d3.event.translate + ")scale(" + d3.event.scale + ")");
}
d3.select(self.frameElement).style("height", height + "px");
d3.select("svg").on("mousedown.log", function() {
  console.log(projection.invert(d3.mouse(this)));
});
</script>
